<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="CommandRefTopic" />
<meta name="DC.Title" content="mti_AddTclCommand()" />
<meta name="abstract" content="Adds a user-defined, Tcl-style simulator command." />
<meta name="description" content="Adds a user-defined, Tcl-style simulator command." />
<meta name="DC.subject" content="mti_AddTclCommand()" />
<meta name="keywords" content="mti_AddTclCommand()" />
<meta name="prodname" content="Foreign Language Interface Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="Including Support for ModelSim® DE/SE and Questa® SIM" />
<meta name="SourceHandle" content="fli" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="none" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="mgc_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Foreign Language Interface Manual" />
<meta name="CSHelp" content="no" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,sort.order.100,doc.type.documentation.ref,product.id.P10467,product.id.P10593,product.id.P11632,product.id.P11633," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id2974bd19-2302-4392-b5ef-7e2b5895a51c" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>mti_AddTclCommand()</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="mti_AddTclCommand()" />
<meta name="attributes" content="product.version.2020.4,sort.order.100,doc.type.documentation.ref,product.id.P10467,product.id.P10593,product.id.P11632,product.id.P11633," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body class="syn-arg" id="id2974bd19-2302-4392-b5ef-7e2b5895a51c">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">mti_AddTclCommand()</h1>
<div class="body refbody CommandRefBody"><div class="abstract CommandRefAbstract"><span class="shortdesc">Adds a user-defined,
Tcl-style simulator command.</span>
</div>
<div class="section Usages"><h2 class="title Subheading sectiontitle">Syntax</h2><div class="section UsageSet"><p class="lines UsageLine">mti_AddTclCommand( cmd_name, cmd_func, cmd_param, func_delete_cb )</p>
</div>
</div>
<div class="section Arguments"><h2 class="title Subheading sectiontitle">Arguments</h2><div class="section ArgumentSet">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table ArgumentTable" frame="void" border="0" rules="none"><colgroup><col style="width:1.815in" /><col style="width:1.863in" /><col style="width:2.821in" /></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry row-nocellborder default-entry" style="vertical-align:top;" id="d32378e159"><p class="p">Name</p>
</th>
<th class="entry row-nocellborder default-entry" style="vertical-align:top;" id="d32378e168"><p class="p">Type</p>
</th>
<th class="entry row-nocellborder default-entry" style="vertical-align:top;" id="d32378e171"><p class="p">Description</p>
</th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e159 "><p class="p">cmd_name</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e168 "><p class="p">char *</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e171 "><p class="p">The name of the command
being added</p>
</td>
</tr>
<tr class="row"><td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e159 "><p class="p">cmd_func</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e168 "><p class="p">Tcl_CmdProc *</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e171 "><p class="p">A pointer to a function
that will be called whenever the command is recognized by the command interpreter</p>
</td>
</tr>
<tr class="row"><td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e159 "><p class="p">cmd_param</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e168 "><p class="p">void *</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e171 "><p class="p">A parameter to be passed
to the command function; OPTIONAL - can be NULL</p>
</td>
</tr>
<tr class="row"><td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e159 "><p class="p">func_delete_cb</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e168 "><p class="p">mtiVoidFuncPtrT</p>
</td>
<td class="entry nocellnorowborder default-entry" style="vertical-align:top;" headers="d32378e171 "><p class="p">A pointer to a function
that will be called if the command is redefined or deleted; OPTIONAL
- can be NULL</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section ReturnedValues"><h2 class="title Subheading sectiontitle">Return Values</h2><p class="p">Nothing</p>
</div>
<div class="section Descriptions"><h2 class="title Subheading sectiontitle">Description</h2><p class="p">mti_AddTclCommand() adds the
specified Tcl command to the simulator. The case of the command
name is significant. The simulator command interpreter subsequently
recognizes the command and calls the command function along with
its parameter and user-supplied arguments whenever the command is
recognized. The command function must return a valid Tcl status
(for example TCL_OK or TCL_ERROR). The command function prototype
is:</p>
<pre class="pre codeblock"><code>int commandFuncName( ClientData cmd_param, Tcl_Interp * interp, int argc, char ** argv)</code></pre><p class="p">You can add a command with the
same name as a previously added command (or even a standard simulator
command), but only the last command added has any effect.</p>
<p class="p">If you give the mti_AddTclCommand()
function a non-NULL delete function callback (the func_delete_cb
parameter), then the simulator calls this callback function when
the command is deleted or redefined. If a restart occurs, or if
another design is loaded, then the simulator deletes the command
prior to the restart or design load, and this will also cause a
call to func_delete_cb. </p>
<p class="p">The delete callback function
prototype is:</p>
<pre class="pre codeblock"><code>void deleteCBname( ClientData cmd_param )</code></pre><p class="p">To make the prototype of mti_AddTclCommand()
visible, you must include the header file <span class="ph filepath">tcl.h</span> in
the FLI application code before <span class="ph filepath">mti.h</span>.</p>
</div>
<div class="section Examples"><h2 class="title Subheading sectiontitle">Examples</h2><div class="section Subsection" id="id2974bd19-2302-4392-b5ef-7e2b5895a51c__idab4957c2-85ef-4a86-99eb-754ac6f36b04"><h2 class="title Subheading sectiontitle">FLI code</h2><pre class="pre codeblock"><code><span class="ph FontProperty P9">#include &lt;stdlib.h&gt;
#include &lt;tcl.h&gt;
#include &lt;mti.h&gt;
typedef struct {
  char         model_name[100];
  mtiSignalIdT sig1;
  mtiSignalIdT sig2;
} instanceInfoT;
int noAction( ClientData param, Tcl_Interp
* interp, int argc, char ** argv )
{
  mti_PrintFormatted( "Time [%ld,%ld] delta
%d:\n",
                     mti_NowUpper(), mti_Now(),
mti_Delta() );
  mti_PrintMessage( "  The printSigs command
has been deactivated.\n" );
  return TCL_OK;
}
void printSigInfo( mtiSignalIdT sigid, char
printFullName )
{
  char * region_name;
  mti_PrintFormatted( "    Signal " );
  if ( printFullName ) {
    region_name = mti_GetRegionFullName(
mti_GetSignalRegion( sigid ));
    mti_PrintFormatted( "%s/", region_name
);
    mti_VsimFree( region_name );
  }
  mti_PrintFormatted( "%s = ", mti_GetSignalName(
sigid ) );
  switch ( mti_GetTypeKind( mti_GetSignalType(
sigid )) ) {
    case MTI_TYPE_SCALAR:
    case MTI_TYPE_ENUM:
    case MTI_TYPE_PHYSICAL:
      mti_PrintFormatted( "%d\n", mti_GetSignalValue(
sigid ) );
      break;
    default:
      mti_PrintFormatted( "(Type not supported)\n"
);
      break;
  }
}
int printRegionInfo( ClientData param, Tcl_Interp
* interp,
                    int argc, char ** argv
)
{
  instanceInfoT * inst_info = (instanceInfoT*)param;
  char            printFullName = 0;
  if ( argc &gt; 1 ) {
    if ( strcmp( argv[1], "full" ) == 0 )
{
         printFullName = 1;
    } else {
         Tcl_SetResult( interp, "printRegionInfo():
Unknown argument",
                       TCL_STATIC );
         return TCL_ERROR;
    }
  }
  mti_PrintFormatted( "Time [%ld,%ld] delta
%d:\n",
                     mti_NowUpper(), mti_Now(),
mti_Delta() );
  mti_PrintFormatted( "  Signal info for
%s:\n", inst_info-&gt;model_name );
  printSigInfo( inst_info-&gt;sig1, printFullName
);
  printSigInfo( inst_info-&gt;sig2, printFullName
);
  if ( mti_Now() &gt; 15 ) {
      mti_AddTclCommand( "printSigs", noAction,
0, 0 );
  }
  return TCL_OK;
}
void deleteCB( ClientData param )
{
  instanceInfoT * inst_info = (instanceInfoT*)param;
  mti_PrintFormatted( "Time [%ld,%ld] delta
%d:\n",
                     mti_NowUpper(), mti_Now(),
mti_Delta() );
  mti_PrintFormatted( "  Deleting old command
data for %s.\n",
                     inst_info-&gt;model_name
);
}
void cleanupCallback( void * param )
{
  mti_PrintMessage( "Cleaning up...\n" );
  free( param );
}
void initForeign(
  mtiRegionIdT       region,   /* The ID
of the region in which this     */
                               /* foreign
architecture is instantiated.  */
  char              *param,    /* The last
part of the string in the     */
                               /* foreign
attribute.                     */
  mtiInterfaceListT *generics, /* A list
of generics for the foreign model.*/
  mtiInterfaceListT *ports     /* A list
of ports for the foreign model.   */
)
{
  instanceInfoT     * inst_info;
  mtiInterfaceListT * portp;
  inst_info = (instanceInfoT *)malloc( sizeof(instanceInfoT)
);
  /* ASSUME param is less than 100 chars
and
   * there are at least two signal ports.
   */
  strcpy( inst_info-&gt;model_name, param );
  portp = ports;
  inst_info-&gt;sig1 = portp-&gt;u.port;
  portp = portp-&gt;nxt;
  inst_info-&gt;sig2 = portp-&gt;u.port;
mti_AddTclCommand( "printSigs", printRegionInfo,
inst_info, deleteCB );
mti_AddQuitCB( cleanupCallback, inst_info
);
mti_AddRestartCB( cleanupCallback, inst_info
);
}</span> </code></pre></div>
<div class="section Subsection" id="id2974bd19-2302-4392-b5ef-7e2b5895a51c__id83d7db63-84a5-4673-a7a2-64836bcb67d9"><h2 class="title Subheading sectiontitle">HDL code</h2><pre class="pre codeblock"><code>library ieee;
use ieee.std_logic_1164.all;

entity for_model is
  port ( inb : in bit;
         ins : in std_logic
        );
end for_model;

architecture a of for_model is
  attribute foreign of a : architecture is
    "initForeign for_model.sl; for_model";
begin
end a;

library ieee;
use ieee.std_logic_1164.all;

entity top is
end top;

architecture a of top is

  signal s1 : bit := '0';
  signal s2 : std_logic := '1';

  component for_model is
    port ( inb : in bit;
            ins : in std_logic
          );
  end component;

  for all : for_model use entity work.for_model(a);

begin

  i1 : for_model
       port map ( s1, s2 );

  s1 &lt;= not s1 after 5 ns;
  s2 &lt;= not s2 after 5 ns;

end a;</code></pre></div>
<div class="section Subsection" id="id2974bd19-2302-4392-b5ef-7e2b5895a51c__id21f57964-163a-4aad-95c5-aa79761add40"><h2 class="title Subheading sectiontitle">Simulation output</h2><pre class="pre codeblock"><code>% vsim -c top
Reading .../modeltech/tcl/vsim/pref.tcl

# 5.5 Dev

# vsim -c top
# Loading .../modeltech/sunos5/../std.standard
# Loading .../modeltech/sunos5/../ieee.std_logic_1164(body)
# Loading work.top(a)
# Loading work.for_model(a)
# Loading ./for_model.sl
VSIM 1&gt; printSigs
# Time [0,0] delta 0:
#   Signal info for for_model:
#     Signal s1 = 0
#     Signal s2 = 3
VSIM 2&gt; printSigs full
# Time [0,0] delta 0:
#   Signal info for for_model:
#     Signal /top/s1 = 0
#     Signal /top/s2 = 3
VSIM 3&gt; run 5
VSIM 4&gt; printSigs
# Time [0,5] delta 1:
#   Signal info for for_model:
#     Signal s1 = 1
#     Signal s2 = 2
VSIM 5&gt; printSigs all
# printRegionInfo(): Unknown argument
VSIM 6&gt; run 5
VSIM 7&gt; printSigs
# Time [0,10] delta 1:
#   Signal info for for_model:
#     Signal s1 = 0
#     Signal s2 = 3
VSIM 8&gt; run 10
VSIM 9&gt; printSigs
# Time [0,20] delta 1:
#   Signal info for for_model:
#     Signal s1 = 0
#     Signal s2 = 3
# Time [0,20] delta 1:
#   Deleting old command data for for_model.
VSIM 10&gt; run 5
VSIM 11&gt; printSigs
# Time [0,25] delta 1:
#   The printSigs command has been deactivated.
VSIM 12&gt; quit
# Cleaning up...</code></pre></div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCChap_FliFunctionDefinitions_id33771d04.html" title="This chapter describes the FLI functions in detail, explaining their purpose, syntax, and usage.">FLI Function Definitions</a></div>
</div>

<div class="linklist linklist relinfo"><strong>Related Topics</strong><br />

<div><a class="link" href="../topics/Command_MtiInterp_idaed03630.html#idaed03630-1c13-4679-bc42-11c4ac03879c__" title="Gets the Tcl_Interp pointer used in the simulator.">mti_Interp()</a></div>
<div><a class="link" href="../topics/Command_MtiSetsignalvalue_id7e78e61e.html#id7e78e61e-5169-4eba-bed7-62d05c907edc__" title="Sets the value of a VHDL signal.">mti_SetSignalValue()</a></div>
<div><a class="link" href="../topics/Command_MtiSetdriverowner_idb40848e0.html#idb40848e0-cc73-43d9-9580-9c4f326ff87a__" title="Sets the owning process of a driver.">mti_SetDriverOwner()</a></div>
<div><a class="link" href="../topics/Command_MtiSchedulewakeup_idff6aa11a.html#idff6aa11a-2e52-4e0d-9a79-2ea839aeb37d__" title="Schedules a VHDL process to wake up at a specific time.">mti_ScheduleWakeup()</a></div>
<div><a class="link" href="../topics/Command_MtiSensitize_id9688a67c.html#id9688a67c-25a1-4711-80f5-0833a0fa6115__" title="Sensitizes a VHDL process to a VHDL or SystemC signal.">mti_Sensitize()</a></div>
<div><a class="link" href="../topics/Command_MtiFree_id3bc85db6.html#id3bc85db6-2623-4375-9be4-1ca9a1fdf76e__" title="Frees simulator-managed memory.">mti_Free()</a></div>
<div><a class="link" href="../topics/Command_MtiVsimfree_id7390869b.html#id7390869b-5e7c-410d-bdaa-025b0b0dae95__" title="Frees simulator-allocated memory.">mti_VsimFree()</a></div>
<div><a class="link" href="../topics/Command_MtiNextregion_id159314df.html#id159314df-f24a-4b34-b684-1baa2dacd364__" title="Gets the next region at the same level as a region.">mti_NextRegion()</a></div>
<div><a class="link" href="../topics/Command_MtiGetsignalsubelements_id1c9db5a2.html#id1c9db5a2-fff0-497f-b8bf-50ed5a09c6dc__" title="Gets the subelements of a composite signal.">mti_GetSignalSubelements()</a></div>
<div><a class="link" href="../topics/Command_MtiTicklength_id7a711375.html#id7a711375-2ca8-42eb-b60f-e7af9c58a751__" title="Gets the length of a type.">mti_TickLength()</a></div></div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "fli"
                DocTitle = "Foreign Language Interface Manual"
                PageTitle = "mti_AddTclCommand()"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Command_MtiAddtclcommand_id2974bd19.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Foreign Language Interface Manual Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>