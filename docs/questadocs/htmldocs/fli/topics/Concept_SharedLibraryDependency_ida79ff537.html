<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Shared Library Dependency" />
<meta name="abstract" content="By default the simulator does not share the symbols defined by any of the shared libraries that it dynamically loads because of the many problems this can cause (such as, symbol clashing). However, you can load libraries with global symbol visibility by using the -gblso argument to vsim. Refer to the Command Reference Manual for details on this argument." />
<meta name="description" content="By default the simulator does not share the symbols defined by any of the shared libraries that it dynamically loads because of the many problems this can cause (such as, symbol clashing). However, you can load libraries with global symbol visibility by using the -gblso argument to vsim. Refer to the Command Reference Manual for details on this argument." />
<meta name="prodname" content="Foreign Language Interface Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="Including Support for ModelSim® DE/SE and Questa® SIM" />
<meta name="SourceHandle" content="fli" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="none" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="mgc_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Foreign Language Interface Manual" />
<meta name="CSHelp" content="no" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,sort.order.100,doc.type.documentation.ref,product.id.P10467,product.id.P10593,product.id.P11632,product.id.P11633," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="ida79ff537-284e-496b-b0d3-2e06a04c6706" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Shared Library Dependency</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Shared Library Dependency" />
<meta name="attributes" content="product.version.2020.4,sort.order.100,doc.type.documentation.ref,product.id.P10467,product.id.P10593,product.id.P11632,product.id.P11633," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="ida79ff537-284e-496b-b0d3-2e06a04c6706">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Shared Library Dependency</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">By default
the simulator does not share the symbols defined by any of the shared
libraries that it dynamically loads because of the many problems
this can cause (such as, symbol clashing). However, you can load
libraries with global symbol visibility by using the -gblso argument
to vsim. Refer to the Command Reference Manual for details on this
argument. </span>
</div>
<p class="p">If you have a shared library that
needs access to symbols in another shared library, but global visibility
is not viable, then you must do one of the following:</p>
<ul class="ul"><li class="li" id="ida79ff537-284e-496b-b0d3-2e06a04c6706__id4206b6fd-a145-4a3e-86c9-50e6600959e3"><p class="p">Put the shared library dependency in
the link of the shared library that has the dependency.</p>
</li>
<li class="li" id="ida79ff537-284e-496b-b0d3-2e06a04c6706__id7dfa39a5-5408-4a98-9f2e-e074d647c622"><p class="p">Code your shared library to dynamically
load the shared library on which it depends and look up the symbols
that it needs.</p>
</li>
</ul>
<div class="section Subsections"><div class="section Subsection" id="ida79ff537-284e-496b-b0d3-2e06a04c6706__id3571f9d8-8019-4ec4-addb-88245d40453d"><h2 class="title Subheading sectiontitle">Example 1</h2><p class="p">This example shows two shared libraries, A
and B. Library B uses functions in library A, and both libraries
are dynamically loaded by <span class="ph fmvar:ProductName">ModelSim/Questa</span>.</p>
<h2 class="title Subheading sectiontitle">FLI Code</h2><pre class="pre codeblock leveled"><code>----- A.c -----

#include &lt;mti.h&gt;

int Afunc1( char * str )
{
    mti_PrintFormatted( "Afunc1 was called with parameter \"%s\".\n", str );
    return 17;
}

int Afunc2( char * str )
{
    mti_PrintFormatted( "Afunc2 was called with parameter \"%s\".\n", str );
    return 211;
}

void initForeign(
    mtiRegionIdT       region,
    char              *param,
    mtiInterfaceListT *generics,
    mtiInterfaceListT *ports
)
{
    mti_PrintFormatted( "+++ Shared lib A initialized.\n" );
}

----- B.c -----

#include &lt;mti.h&gt;

extern int Afunc1( char * );
extern int Afunc2( char * );

void loadDoneCallback( void * param )
{
    int retval;

    retval = Afunc2( "B calling Afunc2" );
    mti_PrintFormatted( "B called Afunc2 which returned %d.\n", retval );
}

void initForeign(
    mtiRegionIdT       region,
    char              *param,
    mtiInterfaceListT *generics,
    mtiInterfaceListT *ports
)
{
    int retval;

    mti_PrintFormatted( "+++ Shared lib B initialized.\n" );

    retval = Afunc1( "B calling Afunc1" );
    mti_PrintFormatted( "B called Afunc1 which returned %d.\n", retval );

    mti_AddLoadDoneCB( loadDoneCallback, 0 );
}</code></pre><h2 class="title Subheading sectiontitle">Compilation Instructions</h2><p class="p">The following commands illustrate how to compile
the files. Refer to <a class="xref fm:HeadingOnly" href="Concept_CompilingLinkingFliCApplications_idf7eb729d.html#idf7eb729d-c716-4293-a657-cbdf42bba6b9__Concept_CompilingLinkingFliCApplications_idf7eb729d.xml#idf7eb729d-c716-4293-a657-cbdf42bba6b9" title="The following platform-specific instructions show you how to compile and link your FLI applications so they can be loaded by ModelSim/Questa. Microsoft Visual C/C++ is supported for creating Windows DLLs while gcc and cc compilers are supported for creating Linux shared libraries.">Compiling and Linking FLI C Applications</a> for instructions on other platforms.</p>
<p class="lines ApplCommand">gcc -c -I$MTI_HOME/include<br />
src/A.cld -G -Bsymbolic -o libA.so A.ogcc -c -I$MTI_HOME/include src/B.cld -G -Bsymbolic -L . -l A -o B.so B.o</p>
<h2 class="title Subheading sectiontitle">Simulation Output</h2><pre class="pre codeblock leveled"><code>setenv LD_LIBRARY_PATH .

vsim -c test -do test.do -foreign "initForeign libA.so" -foreign "initForeign B.so"
Reading .../&lt;product&gt;/tcl/vsim/pref.tcl

# vsim -do test.do -foreign {initForeign libA.so} -foreign {initForeign B.so} -c test
# Loading ../sunos5/../std.standard
# Loading work.test(a)
# Loading ./libA.so
# +++ Shared lib A initialized.
# Loading ./B.so
# +++ Shared lib B initialized.
# Afunc1 was called with parameter "B calling Afunc1".
# B called Afunc1 which returned 17.
# Afunc2 was called with parameter "B calling Afunc2".
# B called Afunc2 which returned 211.
# do test.do</code></pre></div>
<div class="section Subsection" id="ida79ff537-284e-496b-b0d3-2e06a04c6706__id69440b02-b2a6-4feb-bdde-6d48ebc62437"><h2 class="title Subheading sectiontitle">Example 2</h2><p class="p">This example shows two shared libraries, A
and C. <span class="ph fmvar:ProductName">ModelSim/Questa</span> dynamically
loads library C which in turn dynamically loads library A.</p>
<p class="p">Library A is the same as in the previous example.</p>
<h2 class="title Subheading sectiontitle">FLI Code</h2><pre class="pre codeblock leveled"><code>----- C.c -----

#include &lt;dlfcn.h&gt;
#include &lt;mti.h&gt;

typedef int (*funcPtrT)(char *);

void initForeign(
    mtiRegionIdT       region,
    char              *param,
    mtiInterfaceListT *generics,
    mtiInterfaceListT *ports
)
{
    int      retval;
    funcPtrT funcH;
    void *   libH;

mti_PrintFormatted( "+++ Shared lib C initialized.\n" );

    libH = dlopen("libA.so", RTLD_LAZY);
    if ( ! libH ) {
        mti_PrintMessage( "ERROR: Failed to load library libA.so.\n" );
    } else {
        funcH = dlsym( libH, "Afunc1" );
        if ( ! funcH ) {
            mti_PrintMessage( "ERROR: Failed to find function \"Afunc1\" "
                              "in library libA.so.\n" );
        } else {
            retval = funcH( "C calling Afunc1" );
            mti_PrintFormatted( "C called Afunc1 which returned %d.\n",
                               retval );
        }
    }
}</code></pre><h2 class="title Subheading sectiontitle">Compilation Instructions</h2><p class="p">The following commands illustrate how to compile
the files. Refer to <a class="xref fm:HeadingOnly" href="Concept_CompilingLinkingFliCApplications_idf7eb729d.html#idf7eb729d-c716-4293-a657-cbdf42bba6b9__Concept_CompilingLinkingFliCApplications_idf7eb729d.xml#idf7eb729d-c716-4293-a657-cbdf42bba6b9" title="The following platform-specific instructions show you how to compile and link your FLI applications so they can be loaded by ModelSim/Questa. Microsoft Visual C/C++ is supported for creating Windows DLLs while gcc and cc compilers are supported for creating Linux shared libraries.">Compiling and Linking FLI C Applications</a> for instructions on other platforms.</p>
<p class="lines ApplCommand">gcc -c -I$MTI_HOME/include<br />
src/A.cld -G -Bsymbolic -o libA.so A.ogcc -c -I$MTI_HOME/include src/C.cld -G -Bsymbolic -o C.so C.o -ldl</p>
<h2 class="title Subheading sectiontitle">Simulation output</h2><pre class="pre codeblock leveled"><code>setenv LD_LIBRARY_PATH .

vsim -c test -do test.do -foreign "initForeign C.so"
Reading .../&lt;product&gt;/tcl/vsim/pref.tcl

# vsim -do test.do -foreign {initForeign C.so} -c test
# Loading ../sunos5/../std.standard
# Loading work.test(a)
# Loading ./C.so
# +++ Shared lib C initialized.
# Afunc1 was called with parameter "C calling Afunc1".
# C called Afunc1 which returned 17.
# do test.do
</code></pre><div class="note note"><span class="notetitle">Note:</span> <p class="p">The initForeign()
function in library A is not called by <span class="ph fmvar:ProductName">ModelSim/Questa</span> because
it does not load library A as a foreign library.</p>
</div>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCChap_Introduction_idf28816f2.html" title="This chapter provides background for using the ModelSim/Questa FLI (Foreign Language Interface) for VHDL.">Introduction</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "fli"
                DocTitle = "Foreign Language Interface Manual"
                PageTitle = "Shared Library Dependency"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_SharedLibraryDependency_ida79ff537.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Foreign Language Interface Manual Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>