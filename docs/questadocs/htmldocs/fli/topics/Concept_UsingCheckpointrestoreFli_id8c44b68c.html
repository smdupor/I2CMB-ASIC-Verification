<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Using Checkpoint/Restore with the FLI" />
<meta name="abstract" content="In order to use checkpoint/restore with the FLI, any data structures that have been allocated in foreign models and certain IDs passed back from FLI function calls must be explicitly saved and restored." />
<meta name="description" content="In order to use checkpoint/restore with the FLI, any data structures that have been allocated in foreign models and certain IDs passed back from FLI function calls must be explicitly saved and restored." />
<meta name="DC.subject" content="checkpoint/restore, using with the FLI" />
<meta name="keywords" content="checkpoint/restore, using with the FLI" />
<meta name="prodname" content="Foreign Language Interface Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="Including Support for ModelSim® DE/SE and Questa® SIM" />
<meta name="SourceHandle" content="fli" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="none" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="mgc_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Foreign Language Interface Manual" />
<meta name="CSHelp" content="no" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,sort.order.100,doc.type.documentation.ref,product.id.P10467,product.id.P10593,product.id.P11632,product.id.P11633," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id8c44b68c-037c-4455-a809-754a071ba239" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Using Checkpoint/Restore with the FLI</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Using Checkpoint/Restore with the FLI" />
<meta name="attributes" content="product.version.2020.4,sort.order.100,doc.type.documentation.ref,product.id.P10467,product.id.P10593,product.id.P11632,product.id.P11633," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="id8c44b68c-037c-4455-a809-754a071ba239">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Using Checkpoint/Restore with the FLI</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">In order to
use checkpoint/restore with the FLI, any data structures that have
been allocated in foreign models and certain IDs passed back from
FLI function calls must be explicitly saved and restored. </span>
</div>
<p class="p">There are two key features to aid with this process.</p>
<ul class="ul"><li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__idf6df0dba-5f1c-420c-b3a9-7ac0941f2d89"><p class="p">Set of memory allocation functions — When you
allocate memory with one of these functions, the simulator will
automatically restore it for you to the same location in memory,
ensuring that pointers into the memory will still be valid. </p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__idf78962e0-59fb-49c5-9ed5-178619528f90"><p class="p">Collection
of explicit functions to save and restore data — You will need to use
these functions for any pointers to your data structures and for
IDs returned from FLI functions. </p>
</li>
</ul>
<p class="p">Pointers that you save and restore must point
to memory allocated by the simulator. Objects in the shared library
will no longer be valid if the shared library is reloaded into a different
location during a restore. If you choose not to use the provided
memory allocation functions, you will have to explicitly save and
restore your allocated memory structures as well.</p>
<p class="p">You must code your model assuming that the
code could reside in a different memory location when restored.
This requires that you update all process pointers during a restore
and re-register all callback functions either in the init function
or after the restore is complete.</p>
<div class="section Subsections"><div class="section Subsection" id="id8c44b68c-037c-4455-a809-754a071ba239__id6bef7cba-6f0f-476d-8818-fab8a9052b33"><h2 class="title Subheading sectiontitle">Example</h2><p class="p"><a class="xref fm:Example" href="#id8c44b68c-037c-4455-a809-754a071ba239__idde97b485-3310-45ca-b9d4-d53ae0ca7b8b">Example 1</a> shows a C model of a two-input AND
gate taken from <span class="ph FontProperty emphasis">/&lt;install_dir&gt;/examples/vhdl/foreign/example_two/gates.c</span>.
It has been adapted for checkpoint/restore, and the added lines
are marked as comments. Note that this example addresses only one
of the foreign architectures in the example file. If you plan to
use the file from the installation directory, you should comment out
the instantiation of the two foreign architectures that are not
used. </p>
<div class="fig fignone ExampleTitle" id="id8c44b68c-037c-4455-a809-754a071ba239__idde97b485-3310-45ca-b9d4-d53ae0ca7b8b"><span class="figcap"><span class="fig--title-label">Example 1. </span>AND
Gate with Checkpoint/Restore</span><pre class="pre codeblock leveled"><code>--    dump: dump_design;
--    monit: monitor;
/*
 * This program creates a process sensitive to two signals and
 * whenever one or both of the signals change it does an AND operation
 * and drives the value onto a third signal.
 */

#include &lt;stdio.h&gt;
#include "mti.h"

typedef struct {
    mtiSignalIdT in1;
    mtiSignalIdT in2;
    mtiDriverIdT out1;
    mtiProcessIdT proc; /* new */
} inst_rec;

void do_and( void * param )
{
    inst_rec * ip = (inst_rec *)param;
    mtiInt32T val1, val2;
    mtiInt32T result;

    val1   = mti_GetSignalValue( ip-&gt;in1 );
    val2   = mti_GetSignalValue( ip-&gt;in2 );
    result = val1 &amp; val2;
    mti_ScheduleDriver( ip-&gt;out1, result, 0, MTI_INERTIAL );
}

void save_data( void * param ) /* new function */
{
    inst_rec * ip = (inst_rec *)param;

    mti_SaveBlock( (char*)&amp;ip, sizeof(ip) );
}

void restore_data( void * param ) /* new function */
{
    inst_rec * ip;

    mti_RestoreBlock( (char*)&amp;ip );
    mti_AddSaveCB( save_data, ip ); /* new */
    mti_RestoreProcess( ip-&gt;proc, "p1", do_and, ip );
}

void nop ( void * param )
{}

void and_gate_init(
    mtiRegionIdT       region,
    char              *param,
    mtiInterfaceListT *generics,
    mtiInterfaceListT *ports
)
{
    inst_rec *ip;
    mtiSignalIdT  outp;

    if ( ! mti_IsRestore() ) { /* new */
        ip = (inst_rec *)mti_Malloc( sizeof(inst_rec) );
        mti_AddSaveCB( save_data, ip ); /* new */
        ip-&gt;in1 = mti_FindPort( ports, "in1" );
        ip-&gt;in2 = mti_FindPort( ports, "in2" );
        outp = mti_FindPort( ports, "out1" );
        ip-&gt;out1 = mti_CreateDriver( outp );
        ip-&gt;proc = mti_CreateProcess( "p1", do_and, ip ); /* changed */
        mti_Sensitize( ip-&gt;proc, ip-&gt;in1, MTI_EVENT ); /* changed */
        mti_Sensitize( ip-&gt;proc, ip-&gt;in2, MTI_EVENT ); /* changed */ } 
    else {
          mti_AddSaveCB( nop, NULL );  }
 
    mti_AddRestoreCB( restore_data, 0 ); /* new */ }</code></pre></div>
<p class="p">The above example displays the following features:</p>
<ul class="ul"><li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__id6ff37172-bb37-4cd7-89ee-c5bfc499d7d8"><p class="p">mti_Malloc( ) is used instead of malloc(
).</p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__idd1fd33ae-37fc-4cbc-b412-a9fc121f4fa6"><p class="p">A callback is added using mti_AddRestoreCB(
) to restore the ip pointer and p1 process.</p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__ida7f47021-16aa-440f-9ebd-d8cf416fff6d"><p class="p">Two callbacks are added using mti_AddSaveCB
to save the ip pointer each time its value is determined.</p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__id50c03fed-33fb-443f-a088-78428f639761"><p class="p">The mti_IsRestore( ) flag is checked
for restore.</p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__id050d616f-022e-42dd-84b2-d4abd4e5b969"><p class="p">When a restore is being done, mti_RestoreBlock(
) is used to restore the ip pointer because mti_SaveBlock( ) was
used to save it. (Restores must be performed in the same order as
saves.) The pointer is saved in this fashion because there are no mti_SavePointer/mti_RestorePointer
routines. </p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__ide46718bd-a66a-48b7-be78-2a6315b35a8a"><p class="p">mti_RestoreProcess( ) is used to update
the process created by mti_CreateProcess( ) with the possibly new
address of the do_and( ) function. (This is in case the foreign
code gets loaded into a different memory location.) All processes <span class="ph FontProperty emphasis">must</span> be
restored in this manner.</p>
</li>
<li class="li" id="id8c44b68c-037c-4455-a809-754a071ba239__id56952123-fc55-4a7b-abdf-9a94ec9738b9"><p class="p">All callbacks must be added with an mti_Add*()
call during first initialization, restart, and restore. The restore
does not restore callbacks because the routines might be located
at different places after the restore operation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/Contain_UsingVhdlFli_id889e364a.html" title="FLI routines are C programming language functions that provide procedural access to information within the HDL simulator, executed via the vsim command. A user-written application can use these functions to traverse the hierarchy of an HDL design, get information about and set the values of VHDL objects in the design, get information about a simulation, and control (to some extent) a simulation run. The header file mti.h externs all of the FLI functions and types that can be used by an FLI application.">Using the VHDL FLI</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "fli"
                DocTitle = "Foreign Language Interface Manual"
                PageTitle = "Using Checkpoint/Restore with the FLI"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_UsingCheckpointrestoreFli_id8c44b68c.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Foreign Language Interface Manual Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>