<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Write-Streaming Mode" />
<meta name="abstract" content="Write-streaming mode is a way of writing a UCDB with optimally low memory overhead." />
<meta name="description" content="Write-streaming mode is a way of writing a UCDB with optimally low memory overhead." />
<meta name="prodname" content="UCDB API Reference" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="ucdbapi_ref" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="none" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="mgc_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="UCDB API Reference" />
<meta name="CSHelp" content="none" />
<meta name="CSDSearchKeywords" content="doc.type.documentation.ref,product.id.P10593,product.version.2020.4" />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="idec156304-ef28-4282-9d70-3c40b884ec75" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Write-Streaming Mode</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Write-Streaming Mode" />
<meta name="attributes" content="doc.type.documentation.ref,product.id.P10593,product.version.2020.4" />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="idec156304-ef28-4282-9d70-3c40b884ec75">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Write-Streaming
Mode</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">Write-streaming
mode is a way of writing a UCDB with optimally low memory overhead. </span>
</div>
<div class="note caution"><span class="cautiontitle">CAUTION:</span> <p class="p">Avoid the write-streaming
use case unless you are a professional tool developer who is concerned
with memory overhead, or you are linked with the Questa kernel (through
PLI, VPI, or FLI) and want to contribute your own data in real time
to a UCDB being saved with the coverage save command executed from
vsim. This is discussed in the section “<a class="xref fm:HeadingAndPage" href="Concept_UsingMtiAdducdbsavecbFliCallback_id41b8fda1.html#id41b8fda1-e5ad-4637-a593-abbd66f28a0e__Concept_UsingMtiAdducdbsavecbFliCallback_id41b8fda1.xml#id41b8fda1-e5ad-4637-a593-abbd66f28a0e" title="The mti_AddUCDBSaveCB callback is designed to work on only one “region” (or scope: a module instance in the example.) This means that if you have data in multiple scopes, you must install the callback multiple times. However, you only need to install the callback for as many scopes as you have coverage data to contribute.">Using the mti_AddUCDBSaveCB FLI Callback</a>”</p>
</div>
<p class="p">An alternative to using write-streaming mode
is to create a UCDB from scratch in memory. For information on how
to do this, refer to “<a class="xref fm:HeadingAndPage" href="Concept_CreateUcdbFromScratchInMemory_iddd6d94ab.html#iddd6d94ab-95ad-45f8-81fa-af546e422479__Concept_CreateUcdbFromScratchInMemory_iddd6d94ab.xml#iddd6d94ab-95ad-45f8-81fa-af546e422479" title="This is the top-level code that calls all of the functions.">Create a UCDB from Scratch in Memory</a>”.</p>
<p class="p">The write-streaming example shows the create-ucdb
example adapted to write-streaming mode. There is also the <span class="ph filepath">examples/ucdb/writestream</span> example
that contains extensive comments on using the mode. </p>
<p class="p">You can find this example in <span class="ph filepath">&lt;install_dir&gt;/examples/ucdb/userguide/use-cases/create-ucdb/</span>.</p>
<pre class="pre codeblock leveled"><code>void 
example_code(const char* ucdbfile) 
{ 
    ucdbFileHandleT filehandle; 
    ucdbT db = ucdb_OpenWriteStream(ucdbfile); 
    create_testdata(db,ucdbfile); 
    filehandle = create_filehandle(db,"test.sv"); 
    create_design_unit(db,"work.top",filehandle,0); 
    create_instance(db,"top","work.top"); 
    create_statement(db,filehandle,6,1); 
    create_statement(db,filehandle,8,1); 
    create_statement(db,filehandle,9,1); 
    create_enum_toggle(db); 
    create_covergroup(db,"cg",filehandle,3); 
    create_coverpoint(db,"t",filehandle,4); 
    create_coverpoint_bin(db,"auto[a]",filehandle,4,1,0,"a"); 
    create_coverpoint_bin(db,"auto[b]",filehandle,4,1,1,"b"); 
    ucdb_WriteStreamScope(db);      /* terminate coverpoint */ 
    ucdb_WriteStreamScope(db);      /* terminate covergroup */ 
    ucdb_WriteStreamScope(db);      /* terminate instance */ 
    printf("Writing UCDB file '%s'\n", ucdbfile); 
    ucdb_Close(db); 
}  </code></pre><p class="p">The differences required to convert the in-memory
creation of data to a write-streaming creation of data are as follows:</p>
<ul class="ul"><li class="li" id="idec156304-ef28-4282-9d70-3c40b884ec75__id24ef0251-46e6-4648-99ff-12e32acd5862"><p class="p">The open call is ucdb_OpenWriteStream(),
which gives the name of the output file. The concept of write-streaming
is that it writes to the file as it runs. So you have to create
objects in the same order as you do for read-streaming mode. The API
is designed to emit errors in case functions are used in the wrong
order, but this has not yet been exposed to third-party developers
for beta testing.</p>
</li>
<li class="li" id="idec156304-ef28-4282-9d70-3c40b884ec75__id2c86763d-dd40-4bf3-b288-79e7b625d91d"><p class="p">The parent pointers for all creation
API calls must be NULL. This emphasizes that the level of hierarchy
for creating the current object relies on the current context. This
will be explained more deeply below. Because no parent pointers
are used, the functions in the example are all of type void, except
for the create_filehandle() routine, because filehandles must be
used when needed. In this case, because the filehandle is global,
it can be used with any object.</p>
</li>
<li class="li" id="idec156304-ef28-4282-9d70-3c40b884ec75__idc32833c4-ca68-461b-8a13-fe2bdcb212e2"><p class="p">The ucdb_WriteStream(db) call is used
to terminate the creation of the current object. For scopes, this
call terminates the creation of the beginning of the scope. The
ucdb_WriteStream(db) call creates the scope as a context and writes
the name of the scope and other information to the file, so that
subsequent objects are created as children of that scope. The API
is actually relatively forgiving about the use of ucdb_WriteStream(db).
It is really like a “flush” to disk. You can remove ucdb_WriteStream(db)
from this example entirely and by placing this line after the include
of <span class="ph filepath">ucdb.h</span>:</p>
<pre class="pre codeblock leveled"><code>#define ucdb_WriteStream(db) ; </code></pre><p class="p">This definition works the same because the
API will flush the current object before writing the next one if
you call any ucdb_Create... API function; it calls ucbd_WriteStream()
implicitly. The utility of having the explicit “flush” capability
of ucdb_WriteStream() is for cases where you are reusing string
storage (as in creating objects from a loop). If you need to set
up string storage in advance of calling ucdb_CreateNextCover(),
for example, then you must flush the current object before calling
ucdb_CreateNextCover(). Because the API is designed for efficiency,
it does not always copy string storage; it makes use of the string
value when you call ucdb_Writestream(), and after that you may change
the value.</p>
</li>
<li class="li" id="idec156304-ef28-4282-9d70-3c40b884ec75__id1418ce0e-5d03-4642-b450-43b3beb9162c"><p class="p">The ucdb_CreateInstanceByName() function
must be used to create the instance. This is name-based for the
design unit rather than using a ucdbScopeT handle.</p>
</li>
<li class="li" id="idec156304-ef28-4282-9d70-3c40b884ec75__id6be05567-2efc-4c0a-9eca-d0abfc792117"><p class="p">The ucdb_WriteStreamScope(db) call must
be used to terminate the scope.</p>
</li>
<li class="li" id="idec156304-ef28-4282-9d70-3c40b884ec75__id6074c516-55c2-4cac-9d0e-865abc2fa0c5"><p class="p">The ucdb_Close(db) function terminates
the write to the file as well as frees the database handle. This
function writes the summary information, which has been calculated
as you were writing the contents of the file.</p>
</li>
</ul>
<p class="p">In write-streaming mode, the nesting of calls
creates the design and test bench hierarchy, which means that ucdb_WriteStreamScope(db)
is not optional because it terminates a scope. Write-streaming mode
maintains a “current scope.” When you create a new scope, it is
added under the current scope, then it itself becomes the current
scope in turn. When a coveritem is added, it is added to the current
scope. When the current scope is terminated, the current scope becomes
the parent of that scope (or none if that scope was itself at the
top-level.) The three calls to ucdb_WriteStreamScope(db) in the
example are commented with the type of the scope they terminate.
If you wanted to write another coverpoint to the covergroup in the
write-streaming example, create it after the line commented with
“// terminate coverpoint” but before the line commented with “//
terminate covergroup.”</p>
<p class="p">Because write-streaming mode has critical dependencies
on order of creation, it is a difficult mode to use. But it is necessary
to use when you want the most seamless mode of integration with
Questa and when you have code linked into Questa through an interface
like VPI.</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCChap_UcdbUseCases_idb8452a48.html" title="Understanding the UCDB data models is a prerequisite to using the API. The API is more general than the specific data models used to represent specific kinds of coverage. It is also important to know how to use the API and understand some specific use scenarios.">UCDB Use Cases</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "ucdbapi_ref"
                DocTitle = "UCDB API Reference"
                PageTitle = "Write-Streaming Mode"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_WriteStreamingMode_idec156304.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">UCDB API Reference Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>