<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Using the mti_AddUCDBSaveCB FLI Callback" />
<meta name="abstract" content="The mti_AddUCDBSaveCB callback is designed to work on only one “region” (or scope: a module instance in the example.) This means that if you have data in multiple scopes, you must install the callback multiple times. However, you only need to install the callback for as many scopes as you have coverage data to contribute." />
<meta name="description" content="The mti_AddUCDBSaveCB callback is designed to work on only one “region” (or scope: a module instance in the example.) This means that if you have data in multiple scopes, you must install the callback multiple times. However, you only need to install the callback for as many scopes as you have coverage data to contribute." />
<meta name="prodname" content="UCDB API Reference" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="ucdbapi_ref" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="none" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="mgc_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="UCDB API Reference" />
<meta name="CSHelp" content="none" />
<meta name="CSDSearchKeywords" content="doc.type.documentation.ref,product.id.P10593,product.version.2020.4" />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id41b8fda1-e5ad-4637-a593-abbd66f28a0e" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Using the mti_AddUCDBSaveCB FLI Callback</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Using the mti_AddUCDBSaveCB FLI Callback" />
<meta name="attributes" content="doc.type.documentation.ref,product.id.P10593,product.version.2020.4" />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="id41b8fda1-e5ad-4637-a593-abbd66f28a0e">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Using the mti_AddUCDBSaveCB FLI Callback</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">The mti_AddUCDBSaveCB
callback is designed to work on only one “region” (or scope: a module
instance in the example.) This means that if you have data in multiple
scopes, you must install the callback multiple times. However, you
only need to install the callback for as many scopes as you have
coverage data to contribute. </span>
</div>
<p class="p"></p>
<p class="p">The mti_AddUCDBSaveCB Foreign
Language Interface (FLI) callback, is executed when the UCDB save
is, either automatically at the end of simulation or when the CLI
is used. The example uses the CLI. (If the Verilog code uses $finish,
which returns control to the operating system, the save must be
set up in advance.)</p>
<p class="p">You can find this example
in <span class="ph filepath">&lt;install_dir&gt;/examples/ucdb/userguide/use-cases/save-callback/</span>.
This example demonstrates use of the callback to create the 2-bin
covergroup from the write-streaming example in the same directory.
The save-callback example uses the callback and the interoperation
of the VPI and FLI.</p>
<pre class="pre codeblock leveled"><code>/* 
 *  Register mymodel with simulator 
 */ 
void register_mymodel() 
{ 
    s_vpi_systf_data systf_data; 
    systf_data.type = vpiSysFunc; 
    systf_data.sysfunctype = vpiSysFuncSized; 
    systf_data.tfname = "$mymodel"; 
    systf_data.calltf = mymodel; 
    systf_data.compiletf = mymodel_setup; 
    systf_data.sizetf = NULL; 
    vpi_register_systf(&amp;systf_data); 
} 
... 
/* 
 *  UCDB Save Callback 
 */ 
void 
mymodel_ucdb_save(ucdbT db, 
                  mtiRegionIdT region, 
                  void* unused) 
{ 
    vpi_printf("Saving UCDB data from VPI model ...\n"); 
    write_ucdb_data(db); 
} 
 
/* 
 *  Register UCDB Save Callback 
 */ 
int mymodel_setup(char* unused) 
{ 
    vpiHandle systf_handle, scope_handle; 
    char* scope_name; 
    mtiRegionIdT FLI_scope_handle; 
 
    /* Get name of enclosing scope through VPI */ 
    systf_handle = vpi_handle(vpiSysTfCall,NULL); 
    scope_handle = vpi_handle(vpiScope,systf_handle); 
    scope_name = vpi_get_str(vpiFullName,scope_handle); 
 
    /* Convert to FLI region id type */ 
    FLI_scope_handle = mti_FindRegion(scope_name); 
    scope_name = mti_GetRegionFullName(FLI_scope_handle); 
 
    /* Install UCDB save callback */ 
    vpi_printf("Installing UCDB Save Callback for %s ...\n",scope_name); 
    mti_AddUCDBSaveCB(FLI_scope_handle,mymodel_ucdb_save,NULL); 
    return 0; 
} </code></pre><p class="p">The callback uses FLI, while
the model uses VPI. A FLI scope handle (region ID) must be derived
from a VPI handle. The only way to do this is by name, specifically,
full name which is a full path to the scope. In the example, “scope_name”
is “top.inst” as returned from VPI but it is “/top/inst” as returned
from FLI. Fortunately, the two different conventions for regarding the
full name are interchangeable, and the FLI scope handle is directly
acquired. </p>
<p class="p">The FLI scope handle (region
ID) is passed to the callback “mymodel_ucdb_save”, but it is unused
in this example. You can also use private data, but no private data
is illustrated in this example. </p>
<p class="p">You can find this example
in <span class="ph filepath">&lt;install_dir&gt;/examples/ucdb/userguide/use-cases/save-callback/</span>.</p>
<pre class="pre codeblock leveled"><code>void 
write_ucdb_data(ucdbT db) 
{ 
    ucdbFileHandleT filehandle; 
    filehandle = create_filehandle(db,"test.sv"); 
    create_covergroup(db,"cg",filehandle,3); 
    create_coverpoint(db,"t",filehandle,4); 
    create_coverpoint_bin(db,"auto[a]",filehandle,4,1,0,"a"); 
    create_coverpoint_bin(db,"auto[b]",filehandle,4,1,1,"b"); 
    ucdb_WriteStreamScope(db);      /* terminate coverpoint */ 
    ucdb_WriteStreamScope(db);      /* terminate covergroup */ 
} </code></pre><p class="p">This example code is part
of the top-level code from the write-streaming example. The code
and the functions called are exactly the same. The difference is
that the enclosing scope (for the module instance “/top/inst” in
this case) has been started or initialized by the UCDB save code
from Questa and will also be terminated by Questa, too. Any write-streaming
mode UCDB API code may be used in the callback. Questa should emit
errors for misuse of the API, and those should appear in the transcript.
You can not install your own UCDB API error handler with VPI, FLI,
or DPI code, because the Questa kernel has already installed its own.</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCChap_UcdbInQuestaAndModelsim_id1d5e9cf0.html" title="If you have a model linked with the simulation kernel through PLI, VPI, or FLI, you can use the Questa coverage save command for a transparent integration of coverage data.">UCDB in Questa and ModelSim</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "ucdbapi_ref"
                DocTitle = "UCDB API Reference"
                PageTitle = "Using the mti_AddUCDBSaveCB FLI Callback"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_UsingMtiAdducdbsavecbFliCallback_id41b8fda1.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">UCDB API Reference Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>