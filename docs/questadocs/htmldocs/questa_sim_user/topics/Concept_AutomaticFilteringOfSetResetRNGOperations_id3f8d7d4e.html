<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Automatic Filtering of Set/Reset RNG Operations" />
<meta name="abstract" content="The RNG Trace feature can help with debugging and identifying random instability issues. It records all operations that modify the randstate of a process or class. Comparing (diff) trace files between two simulations can help in the stability analysis." />
<meta name="description" content="The RNG Trace feature can help with debugging and identifying random instability issues. It records all operations that modify the randstate of a process or class. Comparing (diff) trace files between two simulations can help in the stability analysis." />
<meta name="prodname" content="Questa SIM User's Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-03-05" />
<meta name="VariantPrefix" content="Q" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="Including Support for Questa SV/AFV" />
<meta name="SourceHandle" content="questa_sim_user" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="5.3" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="questa_sim_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Questa® SIM User's Manual" />
<meta name="CSHelp" content="none" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,sort.order.020,doc.type.documentation.user,product.id.P10593,product.id.P11633,product.id.P11632," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="_bk_questa_sim" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id3f8d7d4e-0242-4328-8853-d172cfaa639f" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Automatic Filtering of Set/Reset RNG Operations</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Automatic Filtering of Set/Reset RNG Operations" />
<meta name="attributes" content="product.version.2020.4,sort.order.020,doc.type.documentation.user,product.id.P10593,product.id.P11633,product.id.P11632," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="id3f8d7d4e-0242-4328-8853-d172cfaa639f">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Automatic Filtering
of Set/Reset RNG Operations</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">The RNG Trace feature can help with
debugging and identifying random instability issues. It records
all operations that modify the randstate of a process or class.
Comparing (diff) trace files between two simulations can help in
the stability analysis.</span>
</div>
<p class="p">Random instability can be introduced when operations
that modify the RNG state of the active thread are conditionally
executed (for example, controlled by a command line option). A common
workaround is to get the randstate prior to the operation(s) and
reset it after the operations. For example:</p>
<p class="p BlockIndent">string rs; ... rs
== process::self().get_randstate();    // get the randstate c1 = new(); // modify the randstate process::self().set_randstate(rs);
// reset the randstate</p>
<p class="p">The above usage of 'set_randstate()' works to address the random
stability introduced by the instantiation of ‘c1’. However, the
associated operations are still recorded in the RNG trace file and
can show up as differences when comparing trace files. It is desirable
to filter these operations to facilitate the comparison.</p>
<p class="p">To do this,<span class="ph fmvar:ProductName">Questa SIM</span> buffers
operations being written to an RNG trace file, then performs a backward
scan of the buffered operation when a set_randstate operation (on
the executing task) is encountered. The tool looks for the first
operation where the input (prior) randstate matches the randstate
of the set_randstate operation. If such a operation is found, the
matching operation along with the reset operation and intervening
operations are filtered (removed from the buffer). </p>
<p class="p">Only RNG operations executed by the active process are considered. </p>
<p class="p">Consider the example above, when set_randstate is called after
a call to new. The sequence of RNG operations is:</p>
<ol class="ol"><li class="li" id="id3f8d7d4e-0242-4328-8853-d172cfaa639f__ide950311e-9a0d-45d3-9247-0f6cf13230cf"><p class="p">Get a seed
value from the thread RNG - changing the randstate from RS1 to RS2.</p>
</li>
<li class="li" id="id3f8d7d4e-0242-4328-8853-d172cfaa639f__iddaa4a6be-2aa4-4e60-8939-88f55a33e14f"><p class="p">Use the seed
to initialize the class RNG - the class RNG is set to RS3.</p>
</li>
<li class="li" id="id3f8d7d4e-0242-4328-8853-d172cfaa639f__id9a4da34a-ac6a-4de1-a4f0-cb1c4b52cede"><p class="p">Call set_randstate
to set the thread RNG to RS1.</p>
</li>
</ol>
<p class="p">The trace buffer records operations 1, 2, and 3. Since operation
1 is a set_randstate operation, the tool scans the buffer backward
from operation 3. Operation 2 is on the same process (thread) but
the input randstate does not match. Operation 1 has a matching process
and input randstate. Therefore, operations 1, 2, and 3 are filtered
(deleted). </p>
<p class="p">If a matching randstate is not found within the buffered operations
no filtering is performed. </p>
<p class="p">When the RNG trace is being written to the transcript (rather
than to a file), the buffering will not be performed and the filtering
is not done. This is because the filtering would delay the reporting
of RNG operation (within the transcript) and make the reporting
confusing.</p>
<p class="p">The length of the buffer can be controlled
by the "vsim -rngtracebuffersize=&lt;value&gt;" command. Setting a
size less than 2 disables filtering. The default is 20. </p>
<p class="p">All buffered trace operations are written to the trace file (flushed)
at the end of simulation. They are also flushed if the trace file
is changed (as in, assignment to the  RNGTraceFile variable).</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/Contain_RandomNumberGeneratorRNG_idad5c3d13.html" title="In System Verilog, various constructs make use of random numbers that are supplied by Random Number Generators (RNGs). A random number generator consists of a generation algorithm and an associated internal state referred to as the randstate.">Random Number Generator (RNG)</a></div>
</div>

<div class="linklist linklist relinfo"><strong>Related Topics</strong><br />

<div><a class="link" href="../topics/Concept_RngOverview_id00013a58.html" title="Every SystemVerilog class instance and every process (thread) has its own randstate. Each process has an associated class instance of type process. The randstate of a SystemVerilog process is that of its associated process class instance.">RNG Overview</a></div>
<div><a class="link" href="../topics/TaskTop_SeedingTheRNG_id2d79dca4.html" title="In SystemVerilog, each thread has its own unique RNG state. The seed of each child thread is initialized from the parent RNG. Questa SIM gives you the ability to seed the root RNG with either a specific integer or a random number.">Seeding the RNG</a></div></div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "questa_sim_user"
                DocTitle = "Questa® SIM User's Manual"
                PageTitle = "Automatic Filtering of Set/Reset RNG Operations"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_AutomaticFilteringOfSetResetRNGOperations_id3f8d7d4e.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Questa® SIM User's Manual Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>