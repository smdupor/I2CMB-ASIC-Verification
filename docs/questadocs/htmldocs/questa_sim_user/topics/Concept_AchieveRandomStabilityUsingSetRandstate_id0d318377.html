<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Achieve Random Stability Using set_randstate" />
<meta name="abstract" content="When code conditionally causes RNG operations it can result in random instability—behavior unrelated to the condition changes. A common way to avoid this kind of random instability is to use the get_randstate and set_randstate methods." />
<meta name="description" content="When code conditionally causes RNG operations it can result in random instability—behavior unrelated to the condition changes. A common way to avoid this kind of random instability is to use the get_randstate and set_randstate methods." />
<meta name="prodname" content="Questa SIM User's Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-03-05" />
<meta name="VariantPrefix" content="Q" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="Including Support for Questa SV/AFV" />
<meta name="SourceHandle" content="questa_sim_user" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="5.3" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="questa_sim_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Questa® SIM User's Manual" />
<meta name="CSHelp" content="none" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,sort.order.020,doc.type.documentation.user,product.id.P10593,product.id.P11633,product.id.P11632," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="_bk_questa_sim" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id0d318377-cde4-4812-af15-f13c82426965" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Achieve Random Stability Using set_randstate</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Achieve Random Stability Using set_randstate" />
<meta name="attributes" content="product.version.2020.4,sort.order.020,doc.type.documentation.user,product.id.P10593,product.id.P11633,product.id.P11632," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="id0d318377-cde4-4812-af15-f13c82426965">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Achieve Random Stability
Using set_randstate</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">When code conditionally
causes RNG operations it can result in random instability—behavior
unrelated to the condition changes. A common way to avoid this kind
of random instability is to use the get_randstate and set_randstate methods.</span>
</div>
<p class="p">In some cases it may
be difficult or infeasible to avoid RNG operations in conditional
code. For example, if you have a common method that includes a call
to <span class="ph filepath">new()</span> and this method is
called in many places in the testbench. </p>
<p class="p">Consider a case where additional analysis code
is added, and it is only executed when a particular simulation option
is specified. The randstate of some thread may be affected by the option,
and the basic simulation changes when the option is enabled versus
disabled. This is particularly problematic if the option is a debug
option.</p>
<p class="p">One way to avoid this random instability is to
avoid RNG operations that may be conditionally executed. In this
case, the <span class="ph filepath">new()</span> would need to
be moved out of the base method. Alternatively, conditional code
could be executed in a separate thread so RNG activity will not
impact other code. However, these approaches can cause unnecessary code
complexity.</p>
<p class="p">You can avoid this kind of random instability
by using the get_randstate and set_randstate methods. Prior to the
conditional RNG activity, use get_randstate() to get the randstate
and then use set_randstate to reset the randstate after the conditional
RNG activity. For example, the print_msg method of class foo in
the code below contains a call to <span class="ph filepath">new()</span>.
There may be additional calls to this method when a particular option
is enabled. </p>
<pre class="pre codeblock"><code>. . .
if (diag_enabled) begin
    f2.pring_mesg("before urandom");
end
f2.x=$urandom();</code></pre><p class="p">There may be additional calls to this method when
a particular option is enabled. </p>
<p class="p">Because the print_msg method modifies the randstate
of the thread, it affects the result of the subsequent call to $urandom.
So when 'diag_enabled' is enabled, 'f2.x' is assigned a different value.
This can be avoided by getting the randstate prior to the call to
print_msg and restoring it after the call. As in:</p>
<pre class="pre codeblock"><code>...
if (diag_enabled) begin
    automatic string rs = process::self.get_randstate();
    f2.print_msg("before urandom");
    process::self.set_randstate(rs);
end
f2.x = $urandom();</code></pre><div class="note note"><span class="notetitle">Note:</span> <p class="p">set_randstate is used in
some UVM code to achieve random stability.</p>
</div>
<div class="section Subsections"><div class="section Subsection" id="id0d318377-cde4-4812-af15-f13c82426965__id76fa219a-cb10-427c-9182-6f0c89c15801"><h2 class="title Subheading sectiontitle">Filtering RNG Operations Preceding a Call
to set_randstate</h2><p class="p">You can use the set_randstate method to achieve
random stability when there are RNG operations in conditional code.
Although random stability is achieved, conditional RNG operations
are logged in a RNG trace file, and comparison of RNG trace files
will show differences in these operations. To facilitate comparison
of trace files, <span class="ph fmvar:ProductName">Questa SIM</span> suppresses
(does not write to the trace file) certain RNG operations.</p>
<p class="p">In general, you can use the set_randstate method
to reset an RNG to a prior randstate, so that a sequence of one
or more RNG operations do not affect future RNG operations. For example,
assume the following operation and associated randstate updates
are performed on the same RNG:</p>
<pre class="pre codeblock"><code>Op1: state1 -&gt; state2
... [get_randstate is used to get a randstate string for state2 (not reported in the trace file)]
op2: state2 -&gt; state3
op3: state3 -&gt; state4
op4: -&gt; state2 [set_randstate used to reset the randstate to state2]
op5: state2 -&gt; state3</code></pre><p class="p">In this case, op4 resets the RNG to the randstate
prior to op2. So operations op2, op3 and op4 have no effect on subsequent
operations of the RNG. RNG Trace suppresses these operations from
the trace file.</p>
<p class="p">In order to detect operations preceding a set_randstate
that should be suppressed, <span class="ph fmvar:ProductName">Questa SIM</span> uses
an output buffer when writing to a trace file. When a set_randstate
operation is written to the buffer, the operations in the buffer,
preceding the set_randstate operation, are scanned. The preceding
operations are scanned (backward) looking for an operation where
the starting randstate matches the randstate of the set_randstate operation.
In the example above, this is op2 because its starting randstate
is state2, which matches the randstate of the set_randstate operation.
The operations between the matching operation and the set_randstate
operation (inclusive) are deleted from the buffer. If no match is found,
no operations are deleted.</p>
<p class="p">If the RNG trace output is directed to the transcript
(that is, no trace file is created), the operations are not buffered
and this filtering is not performed.</p>
<p class="p">The default buffer size is 20. You can set the
buffer size with the “-rngtracebuffersize=&lt;value&gt;” argument for
vsim. If you set the buffer size to 1 or less no filtering is performed.</p>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/Contain_RandomStability_id5dd5ec30.html" title="The predictability of a sequence of random values is referred to as random stability.">Random Stability</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "questa_sim_user"
                DocTitle = "Questa® SIM User's Manual"
                PageTitle = "Achieve Random Stability Using set_randstate"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_AchieveRandomStabilityUsingSetRandstate_id0d318377.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Questa® SIM User's Manual Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>