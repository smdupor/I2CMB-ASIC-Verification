<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Registering PLI Applications" />
<meta name="abstract" content="Each PLI application must register its system tasks and functions with the simulator, providing the name of each system task and function and the associated callback routines." />
<meta name="description" content="Each PLI application must register its system tasks and functions with the simulator, providing the name of each system task and function and the associated callback routines." />
<meta name="DC.subject" content="Verilog PLI/VPI/DPI, registering PLI applications" />
<meta name="keywords" content="Verilog PLI/VPI/DPI, registering PLI applications" />
<meta name="prodname" content="Questa SIM User's Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-03-05" />
<meta name="VariantPrefix" content="Q" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="Including Support for Questa SV/AFV" />
<meta name="SourceHandle" content="questa_sim_user" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="5.3" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="questa_sim_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Questa® SIM User's Manual" />
<meta name="CSHelp" content="none" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,sort.order.020,doc.type.documentation.user,product.id.P10593,product.id.P11633,product.id.P11632," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="_bk_questa_sim" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="ida6f15c09-2ab1-4e8c-b83b-8d608f3c7d5c" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Registering PLI Applications</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Registering PLI Applications" />
<meta name="attributes" content="product.version.2020.4,sort.order.020,doc.type.documentation.user,product.id.P10593,product.id.P11633,product.id.P11632," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="ida6f15c09-2ab1-4e8c-b83b-8d608f3c7d5c">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Registering PLI Applications</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">Each PLI application
must register its system tasks and functions with the simulator,
providing the name of each system task and function and the associated
callback routines.</span>
</div>
<p class="p">Since many PLI applications already
interface to Verilog-XL, <span class="ph fmvar:ProductName">Questa SIM</span> Verilog
PLI applications make use of the same mechanism to register information
about each system task and function in an array of s_tfcell structures.
This structure is declared in the veriuser.h include file as follows:</p>
<pre class="pre codeblock leveled"><code>typedef int (*p_tffn)();</code></pre><pre class="pre codeblock leveled"><code>typedef struct t_tfcell {
   short type;      /* USERTASK, USERFUNCTION, or USERREALFUNCTION */
   short data;      /* passed as data argument of callback function */
   p_tffn checktf;  /* argument checking callback function */
   p_tffn sizetf;   /* function return size callback function */
   p_tffn calltf;   /* task or function call callback function */
   p_tffn misctf;   /* miscellaneous reason callback function */
   char *tfname;    /* name of system task or function */</code></pre><pre class="pre codeblock leveled"><code>      /* The following fields are ignored by <span class="ph fmvar:ProductName">Questa SIM</span> Verilog */
   int forwref;
   char *tfveritool;
   char *tferrmessage;
   int hash;
   struct t_tfcell *left_p;
   struct t_tfcell *right_p;
   char *namecell_p;
   int warning_printed;
} s_tfcell, *p_tfcell;</code></pre><p class="p">The various callback functions (checktf, sizetf,
calltf, and misctf) are described in detail in the IEEE Std 1364.
The simulator calls these functions for various reasons. All callback
functions are optional, but most applications contain at least the
calltf function, which is called when the system task or function
is executed in the Verilog code. The first argument to the callback functions
is the value supplied in the data field (many PLI applications do
not use this field). The type field defines the entry as either
a system task (USERTASK) or a system function that returns either
a register (USERFUNCTION) or a real (USERREALFUNCTION). The tfname field
is the system task or function name (it must begin with $). The
remaining fields are not used by <span class="ph fmvar:ProductName">Questa SIM</span> Verilog.</p>
<p class="p">On loading a PLI application,
the simulator first looks for an init_usertfs function, and then
a veriusertfs array. If init_usertfs is found, the simulator calls
that function so that it can call mti_RegisterUserTF() for each
system task or function defined. The mti_RegisterUserTF() function
is declared in veriuser.h as follows:</p>
<pre class="pre codeblock leveled"><code>void mti_RegisterUserTF(p_tfcell usertf);</code></pre><p class="p">The
storage for each usertf entry passed to the simulator must persist
throughout the simulation because the simulator de-references the
usertf pointer to call the callback functions. We recommend that
you define your entries in an array, with the last entry set to
0. If the array is named veriusertfs (as is the case for linking
to Verilog-XL), then you do not have to provide an init_usertfs
function, and the simulator automatically registers the entries
directly from the array (the last entry must be 0). For example,</p>
<pre class="pre codeblock leveled"><code>s_tfcell veriusertfs[] = {
	{usertask, 0, 0, 0, abc_calltf, 0, "$abc"},
	{usertask, 0, 0, 0, xyz_calltf, 0, "$xyz"},
	{0}  /* last entry must be 0 */
};</code></pre><p class="p">Alternatively, you can add an init_usertfs
function to explicitly register each entry from the array:</p>
<pre class="pre codeblock leveled"><code>void init_usertfs()
{
	p_tfcell usertf = veriusertfs;
	while (usertf-&gt;type)
		mti_RegisterUserTF(usertf++);
}</code></pre><p class="p">It is an error if a PLI shared library does
not contain a veriusertfs array or an init_usertfs function.</p>
<p class="p">Since PLI applications are dynamically loaded
by the simulator, you must specify which applications to load (each
application must be a dynamically loadable library, see “<a class="xref fm:HeadingOnly" href="Contain_CompilingLinkingCApplicationsInterfaces_idd933c82e.html#idd933c82e-20aa-48f6-a089-ac69cad3d28d__Contain_CompilingLinkingCApplicationsInterfaces_idd933c82e.xml#idd933c82e-20aa-48f6-a089-ac69cad3d28d" title="The following platform-specific instructions show you how to compile and link your HDL interface C applications so that they can be loaded by Questa SIM. Various native C/C++ compilers are supported on different platforms. The gcc compiler is supported on all platforms.">Compiling and Linking C Applications for Interfaces</a>”). The PLI applications are specified
as follows (note that on a Windows platform the file extension would
be <span class="ph filepath">.dll</span>):</p>
<ul class="ul"><li class="li" id="ida6f15c09-2ab1-4e8c-b83b-8d608f3c7d5c__ida732beb3-e37d-45be-9425-12bef0010af6"><p class="p">As a list in the Veriuser entry in the
modelsim.ini file:</p>
<p class="lines ApplCommand">Veriuser = pliapp1.so pliapp2.so pliappn.so</p>
</li>
<li class="li" id="ida6f15c09-2ab1-4e8c-b83b-8d608f3c7d5c__id988a8be1-32b1-4e50-be14-91ccc38b5fc4"><p class="p">As a list in the PLIOBJSenvironment variable:</p>
<p class="lines ApplCommand">% setenv PLIOBJS "pliapp1.so pliapp2.so pliappn.so"</p>
</li>
<li class="li" id="ida6f15c09-2ab1-4e8c-b83b-8d608f3c7d5c__id897fdbe3-e761-42cf-81eb-21f670d6980a"><p class="p">As a -pli argument to the simulator (multiple
arguments are allowed):</p>
<p class="lines ApplCommand">-pli pliapp1.so -pli pliapp2.so -pli pliappn.so</p>
</li>
</ul>
<p class="p">The various methods of specifying PLI applications
can be used simultaneously. The libraries are loaded in the order
listed above. Environment variable references can be used in the
paths to the libraries in all cases.</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCAppe_VerilogInterfacesC_idca840682.html" title="This appendix describes the Questa SIM implementation of the Verilog interfaces:">Verilog Interfaces to C</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "questa_sim_user"
                DocTitle = "Questa® SIM User's Manual"
                PageTitle = "Registering PLI Applications"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_RegisteringPliApplications_ida6f15c09.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Questa® SIM User's Manual Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>