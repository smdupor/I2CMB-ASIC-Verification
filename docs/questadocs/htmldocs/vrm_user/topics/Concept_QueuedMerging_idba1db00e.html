<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Queued Merging" />
<meta name="abstract" content="The queued merging flow is the default if both the ucdbfile and the mergefile parameters are defined for a given execScript Action." />
<meta name="description" content="The queued merging flow is the default if both the ucdbfile and the mergefile parameters are defined for a given execScript Action." />
<meta name="prodname" content="Verification Run Manager User Guide" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="vrm_user" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="5.3" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="questa_sim_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="QuestaÂ® Verification Run Manager User Guide" />
<meta name="CSHelp" content="no" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,doc.type.documentation.user,doc.type.documentation.ref,product.id.P10593," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="_bk_questa_sim" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="idba1db00e-d875-46ec-ada9-65f59f61b732" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Queued Merging</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Queued Merging" />
<meta name="attributes" content="product.version.2020.4,doc.type.documentation.user,doc.type.documentation.ref,product.id.P10593," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="idba1db00e-d875-46ec-ada9-65f59f61b732">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Queued Merging</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">The queued
merging flow is the default if both the <span class="ph FontProperty emphasis">ucdbfile</span> and
the <span class="ph FontProperty emphasis">mergefile</span> parameters
are defined for a given <span class="ph FontProperty emphasis">execScript</span> Action.</span>
</div>
<p class="p">Queued merging is a variation
on incremental merging, and the default auto-merge algorithm. With
incremental merging, a separate vcover merge command is launched
for each regression test and the individual vcover processes compete
for access to the target merge file. With queued merging, VRM accumulates
a list of UCDB files to be merged to a particular target merge file
and then manages the launching of one or more vcover merge commands
as follows:</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id20983b60-c51e-497d-8f54-7e7b1c8c8a82"><p class="p">The UCDB files from multiple regression
tests that finish within a small time window are merged as part
of a single vcover merge operation.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id81163d7c-a97a-4d75-abfa-c7882b49bdad"><p class="p">The overhead of file locking on the target
merge file is avoided.</p>
</li>
</ul>
<p class="p">This merge methodology can improve the overall
merge performance by taking advantage of spare CPU cycles to get
a head start on the merge process while some of the simulations
are still running.</p>
<div class="section Subsections"><div class="section Subsection" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id6aee932c-6b35-45a8-bdf9-ee1b8446d8d9"><h2 class="title Subheading sectiontitle">Assumptions and Detailed Behavior</h2><p class="p">The initial steps of this behavior are identical
to those of the incremental merging flow. Only the merging process
is different.</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id8e2fa73e-105a-4c18-97b3-2c2af8d1b139"><p class="p">Each Task Runnable identifies both a <span class="ph FontProperty emphasis">ucdbfile</span> parameter
and a <span class="ph FontProperty emphasis">mergefile</span> parameter
(both parameters are usually inherited from a lineal parent).</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id7d9443df-559a-4530-abcf-aec3eac9cef5"><p class="p">The <span class="ph FontProperty emphasis">ucdbfile</span> parameter
points to the UCDB file generated by the regression test represented
by the Task. If the Task intentionally does not generate a UCDB
file, the <span class="ph FontProperty emphasis">ucdbfile</span> parameter
must be undefined or empty.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id58e27af5-81c3-4079-92ff-4d9d1d42771d"><p class="p">The <span class="ph FontProperty emphasis">mergefile</span> parameter
points to the target of the merge operation. The value of this parameter
can be a path relative to the working directory for the Task or
it can be an absolute path, possibly based on one of the VRM built-in
path parameters (such as <span class="ph filepath">VRMDATA</span>). </p>
</li>
</ul>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id4b63301a-6449-4b28-a08c-5eeb677e06a3"><p class="p">Merge algorithm (<span class="ph FontProperty emphasis">execScript</span>)</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id3c8a18ce-a09a-4ceb-97f0-485efaf679db"><p class="p">Each <span class="ph FontProperty emphasis">execScript</span> dumps
a UCDB file to the location specified by the <span class="ph FontProperty emphasis">ucdbfile</span> parameter
(expanded from the point of view of the Task).</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id5a1e79b9-2d55-4526-9c79-c9cb574d608e"><p class="p">The pass/fail status is then checked
by the <span class="ph filepath">AnalyzePassFail</span> user-definable procedure
and sent to the <span class="ph filepath">OkToMerge</span> user-definable procedure.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id12ccee6b-22c8-4b1c-a7e8-b92980457f35"><p class="p">If the <span class="ph filepath">OkToMerge</span> procedure
returns true, then the <span class="ph filepath">MergeOneUcdb</span> user-definable
procedure is called to merge the test-level UCDB into the target
merge file.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id219952ba-cc04-430b-b7b7-affa6ffd65c7"><p class="p">The <span class="ph filepath">MergeOneUcdb</span> procedure
(when called in queued merge mode) determines whether a merge to
the specified target merge file (as defined by the <span class="ph FontProperty emphasis">mergefile</span> parameter)
is currently ongoing.</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__ideed33a10-4ecb-4ce0-b417-15e6d20f5533"><p class="p">If no such merge is ongoing and the target
merge file does not yet exist, then the UCDB file to be merged is
simply copied to the <span class="ph FontProperty emphasis">mergefile</span> location
(this prevents a file locking race condition).</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id89d39b0e-576f-4bef-a087-514772b2100e"><p class="p">If no such merge is ongoing and the target
merge file exists, then a <span class="ph FontProperty emphasis">mergeScript</span> Action
is scheduled to perform the merge. This Action is treated like any
other Action in the RMDB database, except that the downstream dependencies
of the <span class="ph FontProperty emphasis">execScript</span> are
copied to the <span class="ph FontProperty emphasis">mergeScript</span> in
order to prevent the next Action from starting before the merge
associated with the prior Action is completed.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id397bbb57-a27c-4419-97a9-228a09194c07"><p class="p">If a merge to the target file is currently
ongoing, the UCDB file associated with the just-completed <span class="ph FontProperty emphasis">execScript</span> is
queued for execution once the ongoing <span class="ph FontProperty emphasis">mergeScript</span> has completed.</p>
</li>
</ul>
</li>
</ul>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id93a2c1b1-00ef-49de-9935-0c834f2fe706"><p class="p">Merge algorithm (<span class="ph FontProperty emphasis">postScript</span>)</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__idb8f31ca1-640f-41cd-a5c9-d51bac1a65cc"><p class="p">When the <span class="ph filepath">OkToMerge</span> procedure
is called on a <span class="ph FontProperty emphasis">postScript</span> Action
(in incremental merging mode), it always returns false; therefore,
preventing any automated merging at the Group level.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id20bd60bf-d1bb-4c8a-8504-8107f1cc6856"><p class="p">The user's <span class="ph FontProperty emphasis">postScript</span> optionally merges
the merge file of the current Group to the merge file of a parent
Group, if any. </p>
</li>
</ul>
</li>
</ul>
<p class="p">Each unique <span class="ph FontProperty emphasis">mergefile</span> parameter
value identifies a unique queue. Therefore, while the vrun algorithm
prevents multiple merges from running against the target merge file <span class="ph filepath">A.ucdb</span>,
another merge process can be running against a different UCDB file
(possibly <span class="ph filepath">B.ucdb</span>) at the same time. The basic
plan is to have only one vcover merge process writing to any given
target merge file at any one time. While this merge process is running,
any test-level UCDB files that become available (because of regression
test completions) are queued until the currently running merge process
has completed. Doing this incurs the following two performance benefits:</p>
<ul class="ul"><li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id1aa9e157-b198-4e5a-b1b2-045409537b3d"><p class="p">By merging multiple test-level UCDB files
at one time, the overhead of reading and rewriting the target merge
file is reduced.</p>
</li>
<li class="li" id="idba1db00e-d875-46ec-ada9-65f59f61b732__id328d3dc3-f884-4793-b02e-d0d341e48cbb"><p class="p">By launching no more than one vcover
merge process against any single target merge file at any one time,
the overhead associated with waiting for an existing file lock to
be released is avoided.</p>
</li>
</ul>
<p class="p">One bit of bookkeeping is necessary. The execution
model of VRM guarantees that when the <span class="ph FontProperty emphasis">postScript</span> Action
of any given Group is executed, the Action scripts associated with
the members of that Group (<span class="ph FontProperty emphasis">execScript</span> Actions
in the case of Tasks or <span class="ph FontProperty emphasis">postScript</span> Actions
in the case of sub-Groups) have completely executed (if the final
product of the Group member is a UCDB file, then the <span class="ph FontProperty emphasis">postScript</span> of
the Group might want to use that UCDB file as the input to another
higher-level merge). Therefore, the queued merging algorithm must
modify the execution graph on-the-fly. When the test-level UCDB
files from one or more regression tests are compiled into a vcover
merge command, a node representing the merge process itself is inserted
into the graph and the vertices from the associated Task Runnables
to the downstream <span class="ph FontProperty emphasis">postScript</span> node
are copied to the node associated with the vcover merge process.
When that process completes, the vertices are removed; only after
all the test-level UCDB files generated by Tasks that are members
of the given Group are merged into the target merge file will the <span class="ph FontProperty emphasis">postScript</span> for
the Group become eligible to run. Note that this is true in general,
even if the <span class="ph FontProperty emphasis">postScript</span> for
the Group does not make use of the target merge file at all and
even if multiple Groups point to the same target merge file.</p>
<p class="p">For example, the user can have a top-level
Group (<span class="ph FontProperty emphasis">nightly</span>)
made up of three sub-Groups (<span class="ph FontProperty emphasis">group1</span>, <span class="ph FontProperty emphasis">group2</span>,
and <span class="ph FontProperty emphasis">group2</span>),
each of which has three Task members. The number of regression tests
in this case is nine (assuming a one-to-one correspondence between
Task Runnables and simulations). The user can decide to merge all
nine regression tests to a single merge file at the top-level of
the scratch directory tree. The <span class="ph FontProperty emphasis">mergefile</span> parameter
can be defined in the top-level Group Runnable, so that all nine
Task Runnables can share the same parameter value. In this case,
the <span class="ph FontProperty emphasis">postScript</span> Action
for <span class="ph FontProperty emphasis">group2</span> would
initially be dependent on the three <span class="ph FontProperty emphasis">execScript</span> Actions
that are listed as members of the <span class="ph FontProperty emphasis">group2</span> Runnable.
However, if the UCDB files generated by these three <span class="ph FontProperty emphasis">execScript</span> Actions
were sent to a single vcover merge process, the <span class="ph FontProperty emphasis">postScript</span> Action
for the <span class="ph FontProperty emphasis">group2</span> Runnable
also becomes dependent on the completion of that vcover merge process.
Once the three UCDB files generated by the <span class="ph FontProperty emphasis">execScript</span> Actions
under the <span class="ph FontProperty emphasis">group2</span> Group
are merged successfully into the target merge file, the <span class="ph FontProperty emphasis">postScript</span> for <span class="ph FontProperty emphasis">group2</span> becomes
eligible to run. This is true even if the merging of some of the
UCDB files resulting from the execution of <span class="ph FontProperty emphasis">execScript</span> Actions
under the two other sub-Groups are still pending (or even if the <span class="ph FontProperty emphasis">execScript</span> Actions
themselves are still pending).</p>
<p class="p">There are other behavioral points common to
both the incremental and queued forms of auto-merging. Refer to â<a class="xref fm:HeadingAndPage" href="Contain_AutoMergeTipsTraps_id4734a6fb.html#id4734a6fb-e5e7-4ead-8717-8505709e6e33__Contain_AutoMergeTipsTraps_id4734a6fb.xml#id4734a6fb-e5e7-4ead-8717-8505709e6e33" title="The following two subsections discuss tips and traps of auto-merging.">Auto-Merge Tips and Traps</a>â for more details.</p>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/Contain_CoverageMergingUseModels_id78b6395c.html" title="By default, VRM supports three levels of automation for coverage merging, as described in the following sections.">Coverage Merging Use Models</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter">Â </div><div class="Footer" id="Footer">Â </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "vrm_user"
                DocTitle = "QuestaÂ® Verification Run Manager User Guide"
                PageTitle = "Queued Merging"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_QueuedMerging_idba1db00e.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">QuestaÂ® Verification Run Manager User GuideÂ Software Version 2020.4<br />Unpublished work. Â©Â Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>