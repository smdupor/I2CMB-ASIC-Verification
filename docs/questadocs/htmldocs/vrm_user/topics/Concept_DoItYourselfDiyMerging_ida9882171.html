<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2020" />
<meta name="DC.rights.owner" content="(C) Copyright 2020" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Do-It-Yourself (DIY) Merging" />
<meta name="abstract" content="Under the DIY merging flow, the user is responsible for calling vcover merge with the proper arguments at the proper time. Those execScript Actions that represent regression tests (that is, those which run simulations) should always generate a UCDB file at the location designated by the ucdbfile parameter in order to support automated pass/fail checking. However, VRM itself will not perform any automated merging. Any coverage merging is performed by the user’s code in one of two ways." />
<meta name="description" content="Under the DIY merging flow, the user is responsible for calling vcover merge with the proper arguments at the proper time. Those execScript Actions that represent regression tests (that is, those which run simulations) should always generate a UCDB file at the location designated by the ucdbfile parameter in order to support automated pass/fail checking. However, VRM itself will not perform any automated merging. Any coverage merging is performed by the user’s code in one of two ways." />
<meta name="prodname" content="Verification Run Manager User Guide" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Mentor Graphics Corporation 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2020-07-10" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="vrm_user" />
<meta name="SoftwareVersionNum" content="2020.4" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="5.3" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="questa_sim_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="none" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Questa® Verification Run Manager User Guide" />
<meta name="CSHelp" content="no" />
<meta name="CSDSearchKeywords" content="product.version.2020.4,doc.type.documentation.user,doc.type.documentation.ref,product.id.P10593," />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="mti2020" />
<meta name="BookcaseHandle" content="_bk_questa_sim" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="HighlightChanges" content="none" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="ida9882171-cd67-4319-948c-1fa520c3e75e" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Do-It-Yourself (DIY) Merging</title>
<link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Do-It-Yourself (DIY) Merging" />
<meta name="attributes" content="product.version.2020.4,doc.type.documentation.user,doc.type.documentation.ref,product.id.P10593," />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.2.009" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="ida9882171-cd67-4319-948c-1fa520c3e75e">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Do-It-Yourself (DIY) Merging</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">Under the DIY
merging flow, the user is responsible for calling vcover merge with
the proper arguments at the proper time. Those <span class="ph FontProperty emphasis">execScript</span> Actions
that represent regression tests (that is, those which run simulations)
should always generate a UCDB file at the location designated by the <span class="ph FontProperty emphasis">ucdbfile</span> parameter
in order to support automated pass/fail checking. However, VRM itself
will not perform any automated merging. Any coverage merging is
performed by the user’s code in one of two ways.</span>
</div>
<ul class="ul"><li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__idbd2b1a0a-553a-4e4b-b7cd-ff761299164e"><p class="p">One or more of the user-supplied Action
scripts (either the <span class="ph FontProperty emphasis">execScript</span> on
behalf of an individual Task or the <span class="ph FontProperty emphasis">postScript</span> on
behalf of a Group) could launch the vcover merge utility in order
to merge coverage results.</p>
</li>
<li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__ide9356f72-319e-44cf-9141-953b9200a2f6"><p class="p">The users can override the <span class="ph filepath">ActionCompleted</span>, <span class="ph filepath">MergeOneUcdb</span>,
and/or <span class="ph filepath">RegressionCompleted</span> user-definable procedures
to implement the merging scheme of their choice.</p>
</li>
</ul>
<p class="p">Beyond the pass/fail checking and calling the
user-definable procedures in the prescribed sequence, VRM will not
participate in the merging process.</p>
<div class="section Subsections"><div class="section Subsection" id="ida9882171-cd67-4319-948c-1fa520c3e75e__id5cf101de-5259-46d8-a720-8a610024959a"><h2 class="title Subheading sectiontitle">Assumptions and Detailed Behavior</h2><ul class="ul"><li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__id0b7f663d-8bba-4d0a-ab87-b77edb58dddf"><p class="p">Each Task Runnable identifies a <span class="ph FontProperty emphasis">ucdbfile</span> parameter
(which is usually inherited from a lineal parent).</p>
<ul class="ul"><li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__id232945c6-275e-42f6-ba2b-a7445400ed80"><p class="p">The value of this parameter is a path
to the UCDB file generated by the regression test represented by
the Task.</p>
</li>
<li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__idbc97d8db-4532-4a4b-91e5-d86428e03562"><p class="p">If a relative path is given, it is assumed
to be relative to the working directory for the Task.</p>
</li>
<li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__id7072e78c-ce20-41d1-9f9b-02855677c9d2"><p class="p">If the Task intentionally does not generate
a UCDB file, then the <span class="ph FontProperty emphasis">ucdbfile</span> parameter
must be undefined or empty or the pass/fail checking reports the
test as failed.</p>
</li>
</ul>
</li>
<li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__id98f8dc61-0a12-46a1-afed-ace729e0f6af"><p class="p">Merge algorithm</p>
<ul class="ul"><li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__id6854be4e-d5f2-45a1-80bd-8332673bfd2b"><p class="p">Each <span class="ph FontProperty emphasis">execScript</span> dumps
a UCDB file to the location specified by the <span class="ph FontProperty emphasis">ucdbfile</span> parameter,
and (optionally) calls vcover merge to merge the <span class="ph FontProperty emphasis">ucdbfile</span> to
a user-defined merge file (the location of which may or may not
be parameterized). The individual UCDB files generated in a given
Group of Tasks could also be merged in a single operation as part
of the <span class="ph FontProperty emphasis">postScript</span> for
the Group.</p>
</li>
<li class="li" id="ida9882171-cd67-4319-948c-1fa520c3e75e__iddbccf005-6b06-4be0-86f3-2f49b1e269d0"><p class="p">A Group <span class="ph FontProperty emphasis">postScript</span> Action
can optionally merge intermediate merge files into higher-level
merge files, as dictated by the hierarchy of the regression suite
(or the user can elect to merge all the test-level UCDB files into
a single merge file as part of the <span class="ph FontProperty emphasis">postScript</span> Action
associated with the top-most Group in the regression suite). </p>
</li>
</ul>
</li>
</ul>
<p class="p">All the user-definable override procedures
(<span class="ph filepath">OkToMerge</span>, <span class="ph filepath">MergeOneUcdb</span>,
and so on) are called in sequence. However, in DIY merging mode,
these procedures do nothing by default. Instead of calling vcover
merge from the Action scripts, it is possible to override these
user-definable procedures such that they invoke the merge operation
from within VRM. In fact, the user can re-implement incremental merging
mode via user-definable procedures if desired.</p>
<p class="p">The user Action script (or override procedure)
is responsible for determining whether or not the coverage from
a given simulation is eligible to be merged into the merge file
(for example, if failed tests are to be omitted from the merge file).</p>
<p class="p">The default VRM behavior, unless otherwise
specified or enabled, assumes the user will handle all post-simulation
processing, including coverage merging, in the Action scripts or
by way of user-defined TCL override procedures. By default, the
contents of the <span class="ph FontProperty emphasis">ucdbfile</span> parameter
is only used to extract the pass/fail status for the associated
simulation for status reporting purposes.</p>
<p class="p">Note that the locking mechanism
in vcover merge protects the user from collisions due to multiple
concurrent simulations completing at once. However, this is not
as efficient as having the <span class="ph FontProperty emphasis">postScript</span> for
the uppermost Group in the regression suite perform the merge in
one step. In order to accomplish a one step merge, the <span class="ph filepath">OkToMerge</span> user-definable
procedure can be modified to write the absolute path of the UCDB
file to a common location where it can be picked up for the vcover merge
command.</p>
<h2 class="title Subheading sectiontitle">DIY Merge Example</h2><p class="p">There are two ways in which DIY merging can
be implemented in a database. The first is via the Action scripts,
calling vcover merge either after a simulation or at the end of
the regression run. For example, the user can modify the <span class="ph FontProperty emphasis">execScript</span> used
by the Task Runnables to invoke vcover merge after each simulation
as shown in <a class="xref fm:Example" href="#ida9882171-cd67-4319-948c-1fa520c3e75e__idf3546232-2503-49c6-ad61-2e22b2e69ecb">Figure 1</a>.</p>
<div class="fig fignone" id="ida9882171-cd67-4319-948c-1fa520c3e75e__idf3546232-2503-49c6-ad61-2e22b2e69ecb"><span class="figcap"><span class="fig--title-label">Figure 1. </span>DIY Merge Invoking vcover merge
After Each Simulation</span><pre class="pre codeblock leveled"><code>&lt;rmdb&gt;
	&lt;runnable name="nightly" type="group"&gt;
		&lt;parameters&gt;
			...
		 &lt;parameter name="mfile"&gt;(%DATADIR%)/nightly/merge.ucdb&lt;/parameter&gt;
		&lt;/parameters&gt;
		 ...
		&lt;preScript&gt;
			...
			&lt;command&gt;file delete -force (%mfile%)&lt;/command&gt;
		&lt;/preScript&gt;
		&lt;execScript launch="vsim"&gt;
			&lt;command&gt;vsim -c top -lib (%DATADIR%)/nightly/work -sv_seed 
				 (%seed%)&lt;/command&gt;
			&lt;command&gt;run -all&lt;/command&gt;
			&lt;command&gt;coverage attribute -name TESTNAME -value 
				 (%testname%)&lt;/command&gt;
			&lt;command&gt;coverage save (%ucdbfile%)&lt;/command&gt;
			&lt;command&gt;if {[file exists (%mfile%)]} {&lt;/command&gt;
			&lt;command&gt;  vcover merge (%mfile%) (%mfile%) 
				 (%ucdbfile%)&lt;/command&gt;
			&lt;command&gt;} else {&lt;/command&gt;
			&lt;command&gt;  file copy (%ucdbfile%) (%mfile%)&lt;/command&gt;
			&lt;command&gt;}&lt;/command&gt;
		&lt;/execScript&gt;
	&lt;/runnable&gt;
	 ...
&lt;/rmdb&gt;</code></pre></div>
<p class="p">Note that the location of the merge file is
independent of the working directory of any specific test. That
means the Tasks that represent simulations can be located at any
hierarchical level in the regression topology and the vcover merge
command will still find the right merge file. Also note that if
the merge file does not already exist, the simulation in question
must be the first one to have completed and no merge is actually
necessary (this also assumes the merge file is deleted at the start
of the regression run, as shown in <a class="xref fm:Example" href="#ida9882171-cd67-4319-948c-1fa520c3e75e__idf3546232-2503-49c6-ad61-2e22b2e69ecb">Figure 1</a>).</p>
<p class="p">Also note that if the location of the merge
file is parameterized, as in <a class="xref fm:Example" href="#ida9882171-cd67-4319-948c-1fa520c3e75e__idf3546232-2503-49c6-ad61-2e22b2e69ecb">Figure 1</a>, care must be taken not to use the
keyword <span class="ph FontProperty emphasis">mergefile</span>,
as the presence of that keyword in the RMDB database trigger the
VRM automated merge process.</p>
<p class="p">Another approach might be to add a <span class="ph FontProperty emphasis">postScript</span> to
the top-level Group Runnable (nightly) that merges all the test-level
UCDB files in one pass as shown in <a class="xref fm:Example" href="#ida9882171-cd67-4319-948c-1fa520c3e75e__idbcb5115b-a04a-49c4-bba0-d1f6d5394d31">Figure 2</a>.</p>
<div class="fig fignone" id="ida9882171-cd67-4319-948c-1fa520c3e75e__idbcb5115b-a04a-49c4-bba0-d1f6d5394d31"><span class="figcap"><span class="fig--title-label">Figure 2. </span>DIY Merge Adding postScript
to Top-level Group Runnable</span><pre class="pre codeblock leveled"><code>&lt;rmdb&gt;
	&lt;runnable name="nightly" type="group"&gt;
		&lt;parameters&gt;
			...
		 &lt;parameter name="mfile"&gt;(%DATADIR%)/nightly/merge.ucdb&lt;/parameter&gt;
		&lt;/parameters&gt;
		...
		&lt;execScript launch="vsim"&gt;
			&lt;command&gt;vsim -c top -lib (%DATADIR%)/nightly/work -sv_seed 
				 (%seed%)&lt;/command&gt;
			&lt;command&gt;run -all&lt;/command&gt;
			&lt;command&gt;coverage attribute -name TESTNAME -value 
				 (%testname%)&lt;/command&gt;
			&lt;command&gt;coverage save (%ucdbfile%)&lt;/command&gt;
		&lt;/execScript&gt;
		&lt;postScript launch="vsim"&gt;
			&lt;command&gt;vcover merge (%mfile%) test*/*.ucdb&lt;/command&gt;
		&lt;/execScript&gt;
	&lt;/runnable&gt;
	...
&lt;/rmdb&gt;</code></pre></div>
<p class="p">Note that this approach requires there are
no UCDB files under the <span class="ph filepath">(%DATADIR%)/nightly</span> tree
other than the test-level UCDB files. It also assumes all the UCDB
files should be merged regardless of the pass/fail status of the corresponding
test. Yet another approach might be to create a directory under <span class="ph filepath">(%DATADIR%)/nightly </span>to
hold the UCDB files from regression tests that passed and to have
the <span class="ph FontProperty emphasis">execScript</span> copy
the UCDB into this directory. The <span class="ph FontProperty emphasis">postScript</span> can
then merge all the files in this directory after the simulations
have been completely executed. This approach also avoids the inefficiency
inherent in the vcover merge locking mechanism.</p>
<p class="p">The other way to accomplish DIY merging is
through the use of user-defined TCL override procedures. There are
probably an infinite number of ways in which this can be done but
one of the simplest is to check the pass/fail status in the <span class="ph filepath">OkToMerge</span> procedure,
add the passing test-level UCDB files to a list as part of the <span class="ph filepath">MergeOneUcdb</span> procedure,
and then invoke the vcover merge process in the <span class="ph filepath">RegressionCompleted</span> procedure. <a class="xref fm:Example" href="#ida9882171-cd67-4319-948c-1fa520c3e75e__ide90b80dd-9d46-47fc-ae25-24127950879a">Figure 3</a> shows one way of doing this.</p>
<div class="fig fignone" id="ida9882171-cd67-4319-948c-1fa520c3e75e__ide90b80dd-9d46-47fc-ae25-24127950879a"><span class="figcap"><span class="fig--title-label">Figure 3. </span>DIY Merge User-defined TCL Override Procedure</span><pre class="pre codeblock leveled"><code>&lt;rmdb loadtcl="diy-merge"&gt;
	&lt;usertcl name="diy-merge"&gt;
	proc OkToMerge {userdata} {
		upvar $userdata data

		if {![string equal $data(ACTION) "execScript"]} {
			return 0 ;# the Action is not a regression test
		}

		if {[string equal $data(ucdbfile) ""]} {
			return 0 ;# the UCDB filename is not specified
		}

		if {![string equal $data(passfail) "pass"]} {
			return 0 ;# the test did not pass, do not merge
		}

		return 1 ;# otherwise, approve the UCDB file for merging
	}

	proc MergeOneUcdb {userdata} {
		upvar $userdata data

		global MyUcdbFiles ;# user-maintained list of files to merge

		lappend MyUcdbFiles $data(ucdbfile) ;# store list of passing UCDB 
			 files
	}

	proc RegressionCompleted {userdata} {
		upvar $userdata data

		global MyUcdbFiles ;# user-maintained list of files to merge

		if {[llength $MyUcdbFiles] &amp;gt; 1]} {
			set mergefile "merge.ucdb"

			set cmd [list [file join $::env(MODEL_TECH) vcover] merge -out 
				 $mergefile]

			# If merge file exists, do an "appending" merge

			if {[file exists $mergefile] &amp;amp;&amp;amp; [file readable 
				 $mergefile]} {
				lappend cmd $mergefile
			}

			# Issue the "vcover merge" command, listing all passed UCDB files

			if {[catch {eval [concat exec $cmd $MyUcdbFiles]} error]} {
				echo "Error: Cannot merge to '$mergefile': '$error'"
			}
		}
	}
	&lt;/usertcl&gt;
&lt;/rmdb&gt;</code></pre></div>
<p class="p">The user-defined override procedures are placed
in a <span class="ph FontProperty emphasis">usertcl</span> element
that is marked for auto-loading. So the overridden behavior becomes
part of the default VRM behavior whenever this RMDB database is
used. The code shown here is overly simplistic in order to illustrate
the point. The behavior can be further customized to meet the user's
needs and/or the regression environment in which VRM is being used.</p>
<p class="p">Note that <a class="xref fm:Example" href="#ida9882171-cd67-4319-948c-1fa520c3e75e__ide90b80dd-9d46-47fc-ae25-24127950879a">Figure 3</a> (overriding the user-definable procedure) implements
a flow very similar to <a class="xref fm:HeadingOnly" href="Concept_ListBasedMerging_id614a9110.html#id614a9110-7025-4795-9034-b482d8f515d0__Concept_ListBasedMerging_id614a9110.xml#id614a9110-7025-4795-9034-b482d8f515d0" title="The list-based merging flow is similar to the DIY flow in that each simulation produces a UCDB file and the postScript Action of a higher-level Group must manually invoke the vcover merge command. The difference is that the postScript Action does not have to search for the UCDB files with a wildcard, as vrun maintains a list of UCDBs from tests that are eligible for merging.">List-based Merging</a>.</p>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/Contain_CoverageMergingUseModels_id78b6395c.html" title="By default, VRM supports three levels of automation for coverage merging, as described in the following sections.">Coverage Merging Use Models</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "vrm_user"
                DocTitle = "Questa® Verification Run Manager User Guide"
                PageTitle = "Do-It-Yourself (DIY) Merging"
                Copyright = "2020"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_DoItYourselfDiyMerging_ida9882171.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Questa® Verification Run Manager User Guide Software Version 2020.4<br />Unpublished work. © Siemens 2020<br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>